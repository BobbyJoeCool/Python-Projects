import tkinter as tk
from tkinter import messagebox
from pytubefix import YouTube, Playlist
import os

class GUI:
    def __init__(self):
        self.root = tk.Tk()
        self.root.title("YouTube Downloader")
        self.root.geometry("500x300")
        self.root.configure(bg="lightyellow")

        # URL entry
        tk.Label(self.root, text="YouTube URL:", bg="lightyellow", fg="black").pack(pady=5)
        self.url_entry = tk.Entry(self.root, width=50)
        self.url_entry.pack(pady=5)

        # Download type (video or playlist)
        self.download_type_var = tk.StringVar(value="video")
        tk.Label(self.root, text="Download Type:", bg="lightyellow", fg="black").pack()
        tk.Radiobutton(self.root, text="Single Video", variable=self.download_type_var, value="video", bg="lightyellow", fg="black").pack()
        tk.Radiobutton(self.root, text="Playlist", variable=self.download_type_var, value="playlist", bg="lightyellow", fg="black").pack()

        # Format type (video or audio)
        self.format_var = tk.StringVar(value="video")
        tk.Label(self.root, text="Format:", bg="lightyellow", fg="black").pack()
        tk.Radiobutton(self.root, text="Video (MP4)", variable=self.format_var, value="video", bg="lightyellow", fg="black").pack()
        tk.Radiobutton(self.root, text="Audio (MP3)", variable=self.format_var, value="audio", bg="lightyellow", fg="black").pack()

        # Download button
        tk.Button(self.root, text="Download", command=self.start_download, bg="lightgreen", fg="black").pack(pady=15)

        self.root.mainloop()

    # ---------------- Downloader Functions ----------------
    def download_video(self, url, path="downloads", audio_only=False):
        try:
            yt = YouTube(url)
            stream = yt.streams.filter(only_audio=True).first() if audio_only else yt.streams.get_highest_resolution()
            if not os.path.exists(path):
                os.makedirs(path)

            out_file = stream.download(output_path=path)
            if audio_only:
                base, ext = os.path.splitext(out_file)
                new_file = base + ".mp3"
                os.rename(out_file, new_file)
                return new_file
            return out_file
        except Exception as e:
            return f"❌ Error: {e}"

    def download_playlist(self, url, path="downloads", audio_only=False):
        try:
            pl = Playlist(url)
            if not os.path.exists(path):
                os.makedirs(path)

            files = []
            for video in pl.videos:
                stream = video.streams.filter(only_audio=True).first() if audio_only else video.streams.get_highest_resolution()
                out_file = stream.download(output_path=path)
                if audio_only:
                    base, ext = os.path.splitext(out_file)
                    new_file = base + ".mp3"
                    os.rename(out_file, new_file)
                    files.append(new_file)
                else:
                    files.append(out_file)
            return files
        except Exception as e:
            return f"❌ Error: {e}"

    def start_download(self):
        url = self.url_entry.get().strip()
        if not url:
            messagebox.showerror("Error", "Please enter a YouTube URL.")
            return

        path = "downloads"
        download_type = self.download_type_var.get()   # "video" or "playlist"
        format_type = self.format_var.get()            # "video" or "audio"

        audio_only = True if format_type == "audio" else False

        if download_type == "video":
            result = self.download_video(url, path, audio_only)
        else:
            result = self.download_playlist(url, path, audio_only)

        if isinstance(result, str) and result.startswith("❌"):
            messagebox.showerror("Error", result)
        else:
            messagebox.showinfo("Success", f"Download complete! Files saved in '{path}' folder.")


# Run the GUI
if __name__ == "__main__":
    GUI()
